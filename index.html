<!DOCTYPE html>
<html lang="pt-BR" data-skin="cyber" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="description" content="Painel T√©cnico de Seguran√ßa do Trabalho - SST" />
  <meta name="author" content="Vytor Vilar" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

  <title>SST ‚Ä¢ Painel T√©cnico</title>
  <link rel="icon" type="image/png" href="icone.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
/* ===========================
   SST ‚Ä¢ Ultra Modern CSS 2026
   Drop-in (mant√©m suas classes)
   =========================== */

:root{
  /* Tipografia */
  --font: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;

  /* Layout */
  --container: 1120px;
  --topbar-h: 72px;

  /* Raios */
  --r-2xs: 10px;
  --r-xs: 12px;
  --r-sm: 14px;
  --r-md: 18px;
  --r-lg: 22px;
  --r-xl: 28px;

  /* Timing */
  --t-fast: 140ms;
  --t: 220ms;
  --t-slow: 520ms;
  --ease: cubic-bezier(.2,.8,.2,1);

  /* Light theme (default) */
  --bg0: #f7f8fc;
  --bg1: #ffffff;
  --fg: #0b1220;
  --muted: rgba(15, 23, 42, 0.58);

  /* Brand (verde premium SST) */
  --p1: #16a34a;   /* primary */
  --p2: #22c55e;   /* accent */
  --p3: #0ea5e9;   /* cyan highlight */
  --p4: #a78bfa;   /* violet highlight */

  /* Superf√≠cies */
  --glass: rgba(255,255,255,0.70);
  --glass-2: rgba(255,255,255,0.55);
  --stroke: rgba(15, 23, 42, 0.10);
  --stroke-2: rgba(15, 23, 42, 0.14);

  /* Sombras */
  --sh-1: 0 10px 26px rgba(2, 6, 23, 0.08);
  --sh-2: 0 20px 60px rgba(2, 6, 23, 0.14);
  --sh-in: inset 0 1px 0 rgba(255,255,255,0.75);

  /* Estados */
  --ok: #16a34a;
  --warn: #f59e0b;
  --err: #ef4444;

  /* Glow (foco / neon suave) */
  --ring: 0 0 0 4px rgba(34,197,94,.16);
  --ring-2: 0 0 0 5px rgba(14,165,233,.14);

  /* Fundo das imagens (se usar) */
  --img-bg: rgba(255,255,255,0.45);
  --img-grid: rgba(15, 23, 42, 0.05);

  /* Scrollbar */
  --sb: rgba(15, 23, 42, 0.18);
  --sb2: rgba(15, 23, 42, 0.08);
}

/* Dark theme */
html[data-theme="dark"]{
  --bg0: #070a12;
  --bg1: #0b1020;
  --fg: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.62);

  --glass: rgba(16, 22, 40, 0.62);
  --glass-2: rgba(16, 22, 40, 0.48);
  --stroke: rgba(255,255,255,0.10);
  --stroke-2: rgba(255,255,255,0.14);

  --sh-1: 0 14px 40px rgba(0,0,0,0.45);
  --sh-2: 0 28px 90px rgba(0,0,0,0.65);
  --sh-in: inset 0 1px 0 rgba(255,255,255,0.08);

  --img-bg: rgba(16, 22, 40, 0.42);
  --img-grid: rgba(255,255,255,0.06);

  --sb: rgba(255,255,255,0.22);
  --sb2: rgba(255,255,255,0.10);
}

/* Reset moderno */
*{ box-sizing: border-box; }
html, body{ height: 100%; }
body{
  margin:0;
  font-family: var(--font);
  color: var(--fg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  /* AURORA + NOISE (sem imagem externa) */
  background:
    radial-gradient(900px 500px at 12% -10%, rgba(34,197,94,.22), transparent 60%),
    radial-gradient(900px 520px at 108% 0%, rgba(14,165,233,.18), transparent 58%),
    radial-gradient(900px 520px at 80% 115%, rgba(167,139,250,.16), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.75), rgba(247,248,252,1)),
    var(--bg0);
}
html[data-theme="dark"] body{
  background:
    radial-gradient(900px 520px at 10% -10%, rgba(34,197,94,.22), transparent 60%),
    radial-gradient(900px 540px at 110% 0%, rgba(14,165,233,.18), transparent 58%),
    radial-gradient(900px 540px at 82% 112%, rgba(167,139,250,.18), transparent 62%),
    linear-gradient(180deg, rgba(7,10,18,0.82), rgba(7,10,18,1)),
    var(--bg0);
}

/* Noise overlay */
body::before{
  content:"";
  position: fixed;
  inset:0;
  pointer-events:none;
  opacity: 0.08;
  mix-blend-mode: overlay;
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0 1px, transparent 1px 3px),
    repeating-linear-gradient(90deg, rgba(0,0,0,.04) 0 1px, transparent 1px 4px);
}
html[data-theme="dark"] body::before{
  opacity: 0.10;
  mix-blend-mode: soft-light;
}

a{ color: inherit; text-decoration: none; }

.container{
  width: min(var(--container), 100%);
  margin: 0 auto;
  padding: 0 14px;
}

*{ scrollbar-width: thin; scrollbar-color: var(--sb) transparent; }
*::-webkit-scrollbar{ height: 10px; width: 10px; }
*::-webkit-scrollbar-thumb{
  background: var(--sb);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
}
*::-webkit-scrollbar-track{ background: transparent; }

/* ===========================
   TOPBAR
   =========================== */
.topbar{
  position: sticky;
  top: 0;
  z-index: 50;
  height: var(--topbar-h);
  display: flex;
  align-items: center;

  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  border-bottom: 1px solid var(--stroke);
  box-shadow: 0 8px 30px rgba(2,6,23,0.08);

  backdrop-filter: blur(16px) saturate(140%);
  -webkit-backdrop-filter: blur(16px) saturate(140%);
}
.topbar-inner{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
}

/* Brand */
.brand{
  display:flex;
  align-items:center;
  gap: 12px;
  min-width: 220px;
}
.logo{
  width: 46px;
  height: 46px;
  border-radius: 18px;
  display:grid;
  place-items:center;
  user-select:none;
  color: #fff;
  font-weight: 950;
  letter-spacing: .6px;

  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.35), transparent 40%),
    linear-gradient(135deg, var(--p1), var(--p2));
  box-shadow: var(--sh-1);
  position: relative;
  overflow: hidden;
}
.logo::after{
  content:"";
  position:absolute;
  inset:-40%;
  background: conic-gradient(from 180deg, transparent 0 30%, rgba(255,255,255,.32), transparent 55% 100%);
  animation: shine 5.2s linear infinite;
  opacity: .55;
}
@keyframes shine{
  to{ transform: rotate(360deg); }
}
.brand h1{
  margin:0;
  font-size: 14px;
  line-height: 1.1;
  letter-spacing: .2px;
}
.brand small{
  display:block;
  margin-top: 2px;
  color: var(--muted);
  font-weight: 750;
}

/* Top actions */
.top-actions{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap: 10px;
  flex-wrap: wrap;
}

/* ===========================
   Tabs
   =========================== */
.tabs{
  display:flex;
  gap: 10px;
  overflow:auto;
  padding: 12px 0 14px;
}
.tab{
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.58));
  color: var(--fg);
  padding: 10px 14px;
  border-radius: 999px;
  cursor: pointer;
  white-space: nowrap;
  user-select: none;

  box-shadow: 0 8px 20px rgba(2,6,23,0.06);
  transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), filter var(--t) var(--ease), border-color var(--t) var(--ease);
}
html[data-theme="dark"] .tab{
  background: linear-gradient(180deg, rgba(16,22,40,.70), rgba(16,22,40,.52));
}
.tab:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 36px rgba(2,6,23,0.10);
  border-color: rgba(34,197,94,.28);
}
.tab[aria-selected="true"]{
  border-color: transparent;
  color: #fff;
  font-weight: 900;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.28), transparent 42%),
    linear-gradient(135deg, var(--p1), var(--p2));
  box-shadow: var(--sh-2);
}

/* ===========================
   Buttons / Pills
   =========================== */
.btn{
  border:none;
  cursor:pointer;
  padding: 10px 12px;
  border-radius: var(--r-sm);
  display:inline-flex;
  align-items:center;
  gap: 8px;
  font-weight: 900;

  transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), filter var(--t) var(--ease), border-color var(--t) var(--ease);
}
.btn:active{ transform: translateY(1px); }

.btn-primary{
  color:#fff;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.28), transparent 42%),
    linear-gradient(135deg, var(--p1), var(--p2));
  box-shadow: var(--sh-1);
}
.btn-primary:hover{
  transform: translateY(-1px);
  box-shadow: var(--sh-2);
  filter: saturate(1.05) brightness(1.03);
}

.btn-ghost{
  color: var(--fg);
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  border: 1px solid var(--stroke);
  box-shadow: 0 10px 26px rgba(2,6,23,0.07);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}
.btn-ghost:hover{
  transform: translateY(-1px);
  box-shadow: 0 18px 44px rgba(2,6,23,0.12);
  border-color: rgba(14,165,233,.22);
}

.pill{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  color: var(--muted);
  font-weight: 900;
  font-size: 12px;
  box-shadow: 0 10px 26px rgba(2,6,23,0.06);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}

.badge{
  display:inline-flex;
  align-items:center;
  gap: 6px;
  padding: 7px 10px;
  border-radius: 999px;
  font-weight: 950;
  font-size: 12px;

  background: rgba(34,197,94,0.12);
  border: 1px solid rgba(34,197,94,0.20);
  color: color-mix(in oklab, var(--p1) 40%, var(--fg) 60%);
}
html[data-theme="dark"] .badge{
  background: rgba(34,197,94,0.14);
  border-color: rgba(34,197,94,0.22);
  color: rgba(255,255,255,0.90);
}

/* ===========================
   Cards
   =========================== */
.card{
  position: relative;
  padding: 14px;
  border-radius: var(--r-md);
  border: 1px solid var(--stroke);

  background:
    radial-gradient(circle at 20% 10%, rgba(34,197,94,.10), transparent 35%),
    radial-gradient(circle at 90% 80%, rgba(14,165,233,.08), transparent 40%),
    linear-gradient(180deg, var(--glass), var(--glass-2));
  box-shadow: var(--sh-1);

  backdrop-filter: blur(14px) saturate(150%);
  -webkit-backdrop-filter: blur(14px) saturate(150%);
}
.card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  pointer-events:none;
  box-shadow: var(--sh-in);
  opacity: .9;
}
.card:hover{
  box-shadow: var(--sh-2);
  border-color: rgba(34,197,94,.18);
}

/* ===========================
   Grid / Row / Text
   =========================== */
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 14px;
}
.row{
  display:flex;
  align-items:center;
  gap: 10px;
  flex-wrap: wrap;
}
.muted{ color: var(--muted); }

/* Section */
main{ padding: 14px 0 110px; }
section{ display:none; }
section.active{ display:block; }

.section-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: 12px;
  margin: 14px 0;
}
.section-head h2{
  margin:0;
  font-size: 18px;
  letter-spacing: .2px;
}

/* ===========================
   Inputs
   =========================== */
input, select, textarea{
  width:100%;
  padding: 12px 12px;
  border-radius: var(--r-sm);
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.55));
  color: var(--fg);
  outline: none;
  box-shadow: 0 10px 26px rgba(2,6,23,0.05);
  transition: box-shadow var(--t) var(--ease), border-color var(--t) var(--ease), transform var(--t) var(--ease), background var(--t) var(--ease);
}
html[data-theme="dark"] input,
html[data-theme="dark"] select,
html[data-theme="dark"] textarea{
  background: linear-gradient(180deg, rgba(16,22,40,.70), rgba(16,22,40,.52));
}
input:focus, select:focus, textarea:focus{
  border-color: rgba(34,197,94,0.40);
  box-shadow: var(--ring), 0 18px 46px rgba(2,6,23,0.10);
  transform: translateY(-1px);
}
::placeholder{ color: color-mix(in oklab, var(--muted) 85%, transparent); }

:focus-visible{
  outline: none;
  box-shadow: var(--ring-2), 0 18px 46px rgba(2,6,23,0.12);
  border-color: rgba(14,165,233,.38);
}

/* ===========================
   EPIs Cards
   =========================== */
.card.epi{
  padding: 16px;
  border-radius: var(--r-md);
  background:
    radial-gradient(circle at 10% 0%, rgba(34,197,94,.12), transparent 40%),
    radial-gradient(circle at 95% 100%, rgba(167,139,250,.10), transparent 45%),
    linear-gradient(180deg, var(--glass), var(--glass-2));
  border: 1px solid var(--stroke);
  box-shadow: var(--sh-1);
  transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), border-color var(--t) var(--ease), filter var(--t) var(--ease);
}
.card.epi:hover{
  transform: translateY(-2px);
  border-color: rgba(34,197,94,.28);
  box-shadow: var(--sh-2);
  filter: saturate(1.03);
}
.epi-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  margin-bottom: 10px;
}
.epi-cat{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  color: color-mix(in oklab, var(--fg) 70%, var(--muted) 30%);
  font-weight: 850;
  font-size: 12px;
  white-space: nowrap;
}
.epi h3{
  margin: 0;
  font-size: 14px;
  line-height: 1.25;
  letter-spacing: .12px;
  min-height: 36px;
}
.epi-sub{
  margin-top: 8px;
  display:flex;
  flex-wrap:wrap;
  gap: 8px;
  align-items:center;
  justify-content:space-between;
}

/* ===========================
   Accordion
   =========================== */
.accordion{ display:flex; flex-direction:column; gap:10px; }

.acc-item{
  border: 1px solid var(--stroke);
  border-radius: var(--r-md);
  overflow:hidden;
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  box-shadow: 0 12px 32px rgba(2,6,23,0.08);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}
.acc-btn{
  width:100%;
  text-align:left;
  padding: 12px 12px;
  background: transparent;
  border:none;
  cursor:pointer;
  color: var(--fg);
  font-weight: 950;
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:center;
}
.acc-body{
  display:none;
  padding: 0 12px 12px;
  color: var(--muted);
  font-weight: 750;
  line-height: 1.55;
}
.acc-item.active .acc-body{ display:block; }

/* ===========================
   Chat + Floating buttons
   =========================== */
.chat-fab{
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 120;
}
.chat-box{
  position: fixed;
  right: 18px;
  bottom: 78px;
  z-index: 121;
  width: 340px;
  max-width: calc(100vw - 36px);
  height: 460px;
  display:none;
  flex-direction:column;

  border-radius: var(--r-lg);
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  box-shadow: var(--sh-2);
  overflow:hidden;

  backdrop-filter: blur(16px) saturate(150%);
  -webkit-backdrop-filter: blur(16px) saturate(150%);
}
.chat-box.active{ display:flex; }

.chat-top{
  padding: 10px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom: 1px solid var(--stroke);
  font-weight: 950;
}
.chat-msgs{
  padding: 12px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap: 10px;
}
.bubble{
  max-width: 85%;
  padding: 10px 12px;
  border-radius: var(--r-sm);
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.52));
  color: var(--fg);
  font-weight: 750;
  line-height: 1.35;
  box-shadow: 0 10px 24px rgba(2,6,23,0.06);
}
html[data-theme="dark"] .bubble{
  background: linear-gradient(180deg, rgba(16,22,40,.70), rgba(16,22,40,.50));
}
.me{ align-self:flex-end; }
.me .bubble{
  border-color: transparent;
  color:#fff;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.26), transparent 42%),
    linear-gradient(135deg, var(--p1), var(--p2));
  box-shadow: var(--sh-1);
}
.chat-input{
  border-top: 1px solid var(--stroke);
  padding: 10px;
  display:flex;
  gap: 8px;
}

/* Floating panel */
.fab-panel{
  position: fixed;
  left: 18px;
  bottom: 18px;
  z-index: 120;
  display:flex;
  flex-direction:column;
  gap: 10px;
  align-items:flex-start;
}
.fab-main{
  width: 56px;
  height: 56px;
  border-radius: 999px;
  border:none;
  cursor:pointer;
  color:#fff;

  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.26), transparent 42%),
    linear-gradient(135deg, var(--p1), var(--p2));
  box-shadow: var(--sh-2);
  transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), filter var(--t) var(--ease);
}
.fab-main:hover{
  transform: translateY(-1px);
  filter: saturate(1.05) brightness(1.03);
}
.fab-actions{
  display:none;
  flex-direction:column;
  gap: 8px;
}
.fab-panel.open .fab-actions{ display:flex; }

.fab-action{
  border-radius: 999px;
  padding: 10px 12px;
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  color: var(--fg);
  cursor:pointer;
  box-shadow: 0 12px 32px rgba(2,6,23,0.10);
  font-weight: 950;
  display:flex;
  align-items:center;
  gap: 8px;
  backdrop-filter: blur(14px) saturate(150%);
  -webkit-backdrop-filter: blur(14px) saturate(150%);
  transition: transform var(--t) var(--ease), box-shadow var(--t) var(--ease), border-color var(--t) var(--ease);
}
.fab-action:hover{
  transform: translateY(-1px);
  box-shadow: var(--sh-2);
  border-color: rgba(34,197,94,.22);
}

/* Toast */
.toast{
  position: fixed;
  right: 18px;
  bottom: 92px;
  z-index: 200;
  padding: 12px 14px;
  border-radius: var(--r-sm);
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(2,6,23,0.92);
  color:#fff;
  box-shadow: var(--sh-2);
  opacity:0;
  transform: translateY(10px);
  transition: var(--t) var(--ease);
  pointer-events:none;
  font-weight: 950;
}
.toast.show{ opacity:1; transform: translateY(0); }
.toast.ok{ background: color-mix(in oklab, rgba(2,6,23,0.92) 30%, var(--ok) 70%); }
.toast.err{ background: color-mix(in oklab, rgba(2,6,23,0.92) 30%, var(--err) 70%); }
.toast.warn{ background: color-mix(in oklab, rgba(2,6,23,0.92) 30%, var(--warn) 70%); color:#111827; }

/* Password modal */
.backdrop{
  position: fixed;
  inset: 0;
  background: rgba(2,6,23,0.62);
  display:none;
  align-items:center;
  justify-content:center;
  z-index: 999;
  padding: 14px;
  backdrop-filter: blur(6px);
}
.backdrop.active{ display:flex; }

.modal{
  width: 420px;
  max-width: 100%;
  border-radius: var(--r-xl);
  border: 1px solid var(--stroke);

  background:
    radial-gradient(circle at 20% 10%, rgba(34,197,94,.12), transparent 42%),
    radial-gradient(circle at 90% 80%, rgba(14,165,233,.10), transparent 44%),
    linear-gradient(180deg, var(--glass), var(--glass-2));

  box-shadow: var(--sh-2);
  padding: 18px;

  backdrop-filter: blur(16px) saturate(150%);
  -webkit-backdrop-filter: blur(16px) saturate(150%);
}
.modal h3{ margin: 0 0 6px; }
.modal .hint{ color: var(--muted); margin: 0 0 12px; font-weight: 750; }

.pass-row{ display:flex; gap:8px; align-items:center; }
.pass-row input{ flex: 1; }

.err{
  margin: 10px 0 0;
  color: rgba(239,68,68,0.96);
  font-weight: 950;
  display:none;
}
.err.show{ display:block; }

/* Footer */
footer{
  border-top: 1px solid var(--stroke);
  padding: 16px 0;
  color: var(--muted);
}

@media (max-width: 680px){
  .brand{ min-width: auto; }
  .topbar-inner{ gap: 10px; }
  .tabs{ padding-top: 8px; }
}

@media (prefers-reduced-motion: reduce){
  *{
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.001ms !important;
    scroll-behavior: auto !important;
  }
}

/* ===========================
   CYBER NEON SKIN
   =========================== */
html[data-skin="cyber"]{
  --bg0: #05060b;
  --bg1: #070a14;
  --fg: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.62);

  --p1: #00ff88;
  --p2: #00d1ff;
  --p3: #a855f7;
  --p4: #ff2bd6;

  --glass: rgba(10, 14, 30, 0.62);
  --glass-2: rgba(10, 14, 30, 0.46);

  --stroke: rgba(255,255,255,0.10);
  --stroke-2: rgba(255,255,255,0.14);

  --sh-1: 0 14px 44px rgba(0,0,0,0.55);
  --sh-2: 0 30px 110px rgba(0,0,0,0.72);

  --ring: 0 0 0 4px rgba(0,209,255,.18);
  --ring-2: 0 0 0 5px rgba(0,255,136,.16);

  --neon-a: rgba(0,255,136,.70);
  --neon-b: rgba(0,209,255,.62);
  --neon-c: rgba(168,85,247,.55);
  --neon-d: rgba(255,43,214,.55);
}

html[data-skin="cyber"] body{
  background:
    radial-gradient(900px 520px at 10% -10%, rgba(0,255,136,.22), transparent 60%),
    radial-gradient(900px 540px at 110% 0%, rgba(0,209,255,.18), transparent 58%),
    radial-gradient(900px 540px at 82% 112%, rgba(255,43,214,.16), transparent 62%),
    linear-gradient(180deg, rgba(5,6,11,0.86), rgba(5,6,11,1)),
    var(--bg0);
}
html[data-skin="cyber"] body::after{
  content:"";
  position: fixed;
  inset:-20%;
  pointer-events:none;
  opacity: .35;
  filter: blur(20px);
  background:
    radial-gradient(circle at 20% 25%, var(--neon-a), transparent 45%),
    radial-gradient(circle at 70% 20%, var(--neon-b), transparent 48%),
    radial-gradient(circle at 80% 75%, var(--neon-d), transparent 52%),
    radial-gradient(circle at 30% 80%, var(--neon-c), transparent 54%);
  animation: cyberAurora 10s linear infinite;
  mix-blend-mode: screen;
}
@keyframes cyberAurora{
  0%{ transform: translate3d(0,0,0) rotate(0deg) }
  50%{ transform: translate3d(2%, -2%, 0) rotate(8deg) }
  100%{ transform: translate3d(0,0,0) rotate(16deg) }
}

html[data-skin="cyber"] .topbar{
  border-bottom: 1px solid rgba(0,209,255,.18);
  box-shadow: 0 10px 40px rgba(0,0,0,0.55);
}
html[data-skin="cyber"] .logo{
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.18), transparent 42%),
    linear-gradient(135deg, var(--p2), var(--p1));
}
html[data-skin="cyber"] .logo::after{ opacity: .75; }

html[data-skin="cyber"] .tab{
  border-color: rgba(255,255,255,.10);
  background: linear-gradient(180deg, rgba(10,14,30,.72), rgba(10,14,30,.52));
  box-shadow: 0 12px 34px rgba(0,0,0,0.40);
}
html[data-skin="cyber"] .tab:hover{
  border-color: rgba(0,209,255,.30);
  box-shadow:
    0 18px 60px rgba(0,0,0,0.55),
    0 0 0 1px rgba(0,255,136,.18),
    0 0 28px rgba(0,209,255,.18);
}
html[data-skin="cyber"] .tab[aria-selected="true"]{
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.16), transparent 42%),
    linear-gradient(135deg, var(--p2), var(--p1));
  box-shadow:
    0 22px 80px rgba(0,0,0,0.65),
    0 0 0 1px rgba(0,255,136,.22),
    0 0 34px rgba(0,255,136,.22),
    0 0 34px rgba(0,209,255,.16);
}

html[data-skin="cyber"] .btn-primary{
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.14), transparent 44%),
    linear-gradient(120deg, var(--p2), var(--p1), var(--p4));
  background-size: 180% 180%;
  animation: neonFlow 3.8s var(--ease) infinite;
  box-shadow:
    0 18px 70px rgba(0,0,0,0.60),
    0 0 0 1px rgba(0,255,136,.22),
    0 0 34px rgba(0,255,136,.20);
}
@keyframes neonFlow{
  0%{ background-position: 0% 50% }
  50%{ background-position: 100% 50% }
  100%{ background-position: 0% 50% }
}

html[data-skin="cyber"] .card{
  border-color: rgba(255,255,255,.10);
  background:
    radial-gradient(circle at 15% 10%, rgba(0,255,136,.10), transparent 40%),
    radial-gradient(circle at 90% 80%, rgba(0,209,255,.10), transparent 40%),
    linear-gradient(180deg, rgba(10,14,30,.68), rgba(10,14,30,.46));
  box-shadow: 0 18px 70px rgba(0,0,0,0.55);
  overflow: hidden;
}
html[data-skin="cyber"] .card::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: inherit;
  pointer-events:none;
  background:
    conic-gradient(from 180deg,
      transparent 0 20%,
      rgba(0,209,255,.28),
      rgba(0,255,136,.28),
      rgba(255,43,214,.22),
      transparent 80% 100%);
  filter: blur(10px);
  opacity: .35;
  animation: neonSpin 7s linear infinite;
  mix-blend-mode: screen;
}
@keyframes neonSpin{ to{ transform: rotate(360deg) } }

html[data-skin="cyber"] input,
html[data-skin="cyber"] select,
html[data-skin="cyber"] textarea{
  background: linear-gradient(180deg, rgba(10,14,30,.72), rgba(10,14,30,.52));
  border-color: rgba(255,255,255,.10);
}
html[data-skin="cyber"] input:focus,
html[data-skin="cyber"] select:focus,
html[data-skin="cyber"] textarea:focus{
  border-color: rgba(0,255,136,.35);
  box-shadow:
    0 0 0 4px rgba(0,209,255,.18),
    0 0 34px rgba(0,255,136,.14),
    0 18px 60px rgba(0,0,0,.60);
}

/* ===========================
   NEO DROPDOWN (EPIs + Riscos)
   =========================== */
.neo-select{ position: relative; width:100%; max-width:420px; z-index:200; }

.neo-trigger{
  width:100%; height:52px; padding:0 16px;
  display:flex; align-items:center; justify-content:space-between;
  border-radius:14px;
  border:1px solid rgba(0,209,255,.35);
  background:
    linear-gradient(135deg, rgba(0,255,136,.18), rgba(0,209,255,.18)),
    rgba(10,14,30,.75);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow:
    0 0 0 1px rgba(0,255,136,.25),
    0 0 26px rgba(0,209,255,.45),
    0 24px 90px rgba(0,0,0,.85);
}

.neo-arrow{ transition: transform .25s ease; }

.neo-panel{
  position:absolute;
  top:calc(100% + 10px);
  left:0;
  width:100%;
  z-index:9999;
  display:none;
  flex-direction:column;
  gap:6px;
  padding:8px;

  background: linear-gradient(180deg, rgba(12,18,40,.97), rgba(6,10,20,.97));
  border-radius:18px;
  border:1px solid rgba(0,209,255,.25);

  box-shadow:
    0 0 0 1px rgba(0,255,136,.30),
    0 0 50px rgba(0,209,255,.35),
    0 40px 140px rgba(0,0,0,.95);

  max-height: 320px;
  overflow: auto;
}

.neo-panel::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:20px;
  background: conic-gradient(
    from 180deg,
    transparent 0 20%,
    rgba(0,209,255,.35),
    rgba(0,255,136,.35),
    rgba(255,43,214,.28),
    transparent 80% 100%
  );
  filter: blur(14px);
  opacity:.5;
  animation: neoSpin 6s linear infinite;
  pointer-events:none;
}
@keyframes neoSpin{ to{ transform:rotate(360deg)} }

.neo-option{
  all:unset;
  cursor:pointer;
  padding:12px 14px;
  border-radius:12px;
  font-weight:900;
  color:rgba(255,255,255,.95);
  transition:.2s ease;
  position: relative;
  z-index: 2;
}

.neo-option:hover{
  background: linear-gradient(90deg, rgba(0,255,136,.35), rgba(0,209,255,.45));
  box-shadow:
    inset 0 0 0 1px rgba(0,255,136,.45),
    0 0 30px rgba(0,209,255,.45);
}

.neo-select[data-open="true"] .neo-panel{
  display:flex;
  animation: neoDrop .25s ease-out;
}
.neo-select[data-open="true"] .neo-arrow{ transform:rotate(180deg); }

@keyframes neoDrop{
  from{ opacity:0; transform:translateY(-8px) scale(.98) }
  to{ opacity:1; transform:translateY(0) scale(1) }
}

/* ‚úÖ evita o menu ficar ‚Äúatr√°s‚Äù */
#epis .card, #riscos .section-head, #riscos .row { overflow: visible !important; }
#epis #catalog{ position: relative; z-index: 1; }
#epis #catalog .card{ position: relative; z-index: 1; }

/* ‚úÖ esconde selects nativos mantendo JS */
.native-hidden{
  position:absolute !important;
  left:-99999px !important;
  top:-99999px !important;
  width:1px !important;
  height:1px !important;
  opacity:0 !important;
  pointer-events:none !important;
}

/* Scrollbar do dropdown */
.neo-panel::-webkit-scrollbar{ width: 10px; }
.neo-panel::-webkit-scrollbar-thumb{
  background: rgba(0,209,255,.35);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
}

/* =========================
   FIX: Busca/filtro de EPIs ficando atr√°s
   ========================= */

/* garante que a se√ß√£o EPIs crie um contexto correto */
#epis{
  position: relative;
  z-index: 1;
}

/* o card da busca (onde tem input + dropdown) precisa ficar acima */
#epis .section-head,
#epis .section-head + .card{
  position: relative;
  z-index: 50;
  overflow: visible; /* importante para o dropdown */
}

/* dropdown em cima de tudo */
#epis #categoryNeo{
  position: relative;
  z-index: 9999;
}
#epis #categoryNeo .neo-panel{
  position: absolute;
  z-index: 10000;
}

/* os cards do cat√°logo ficam abaixo */
#epis #catalog{
  position: relative;
  z-index: 1;
}
#epis #catalog .card,
#epis #catalog .epi{
  position: relative;
  z-index: 1;
}


  </style>
</head>

<body>
  <div id="app">
    <header class="topbar">
      <div class="container topbar-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true">SST</div>
          <div>
            <h1>Painel T√©cnico ‚Ä¢ Seguran√ßa do Trabalho</h1>
            <small>Vers√£o 3.0 ‚Ä¢</small>
          </div>
        </div>

        <div class="top-actions">
          <span class="pill" id="statusPill" title="Status do sistema">‚úÖ Online</span>
          <button class="btn btn-ghost" id="pdfBtn" title="Salvar PDF da se√ß√£o atual">üßæ PDF</button>
        </div>
      </div>
    </header>

    <div class="container">
      <nav class="tabs" aria-label="Navega√ß√£o principal" role="tablist">
        <button class="tab" role="tab" data-tab="epis" aria-selected="true" title="Cat√°logo de EPIs">üìí EPIs</button>
        <button class="tab" role="tab" data-tab="riscos" aria-selected="false" title="Avalia√ß√£o de Riscos">üß™ Riscos</button>
        <button class="tab" role="tab" data-tab="empresas" aria-selected="false" title="Gerador de frases por empresa">üè¢ Frases</button>
        <button class="tab" role="tab" data-tab="treinamento" aria-selected="false" title="Plano de A√ß√£o 5W2H">üìö 5W2H</button>
        <button class="tab" role="tab" data-tab="riscos_empresas" aria-selected="false" title="Riscos por empresa">üìã Riscos/Empresa</button>
        <button class="tab" role="tab" data-tab="nrs" aria-selected="false" title="Normas Regulamentadoras">üìñ NRs</button>
        <button class="tab" role="tab" data-tab="painel_tecnico" aria-selected="false" title="Painel t√©cnico e FAQ">üõ† Painel</button>
      </nav>
    </div>

    <main class="container" id="main">

      <!-- ===== EPIs ===== -->
      <section id="epis" class="active" aria-label="Cat√°logo de EPIs">
        <div class="section-head">
          <div>
            <h2>Cat√°logo de EPIs</h2>
            <div class="muted" id="epiCount">‚Äî</div>
          </div>
          <div class="row">
            <button class="btn btn-ghost" id="clearEpiBtn" title="Limpar busca e filtro">‚ùå Limpar</button>
          </div>
        </div>

        <div class="card">
          <div class="row">
            <input id="searchInput" type="text" placeholder="Buscar por nome, CA ou categoria..." aria-label="Buscar EPIs" />

            <!-- ‚úÖ Dropdown Cyber: categorias dos EPIs -->
            <div class="neo-select" id="categoryNeo" data-open="false">
              <button class="neo-trigger" type="button" aria-expanded="false" aria-label="Filtrar por categoria">
                <span class="neo-label">üåê Todas as categorias</span>
                <span class="neo-arrow">‚ñæ</span>
              </button>
              <div class="neo-panel" role="listbox" aria-label="Lista de categorias">
                <!-- preenchido via JS -->
              </div>
            </div>
          </div>

               <div style="height:12px"></div>
        <div id="catalog" class="grid" aria-live="polite"></div>
      </section>

      <!-- ===== RISCOS ===== -->
      <section id="riscos" aria-label="Avalia√ß√£o de Riscos">
        <div class="section-head">
          <div>
            <h2>Avalia√ß√£o de Riscos</h2>
            <div class="muted">Modelos prontos para copiar</div>
          </div>
          <div class="row">
            <!-- ‚úÖ select REAL (escondido) para manter seu listener funcionando -->
            <select id="riskFilter" class="native-hidden" aria-label="Filtro de riscos">
              <option value="todos">Todos</option>
              <option value="fisico">F√≠sico üìò</option>
              <option value="biologico">Biol√≥gico üß¨</option>
              <option value="quimico">Qu√≠mico üß™</option>
            </select>

            <!-- ‚úÖ dropdown visual -->
            <div class="neo-select" id="riskNeo" data-open="false" style="max-width:240px">
              <button class="neo-trigger" type="button" aria-expanded="false" aria-label="Filtro de riscos" title="Filtrar por tipo de risco">
                <span class="neo-label">Todos</span>
                <span class="neo-arrow">‚ñæ</span>
              </button>

              <div class="neo-panel" role="listbox" aria-label="Lista de riscos">
                <button class="neo-option" type="button" data-value="todos">Todos</button>
                <button class="neo-option" type="button" data-value="fisico">F√≠sico üìò</button>
                <button class="neo-option" type="button" data-value="biologico">Biol√≥gico üß¨</button>
                <button class="neo-option" type="button" data-value="quimico">Qu√≠mico üß™</button>
              </div>
            </div>
          </div>
        </div>

        <div class="grid" id="riskCards"></div>
      </section>

      <!-- ===== FRASES EMPRESA ===== -->
      <section id="empresas" aria-label="Frases com Empresa">
        <div class="section-head">
          <div>
            <h2>Gerador de Frases com Empresa</h2>
            <div class="muted">Um nome por linha</div>
          </div>
          <div class="row">
            <button class="btn btn-primary" id="genPhrasesBtn" title="Gerar frases">‚ö° Gerar</button>
            <button class="btn btn-ghost" id="exportTxtBtn" title="Exportar TXT">üìÑ TXT</button>
          </div>
        </div>

        <div class="grid">
          <div class="card">
            <textarea id="nomes" rows="10" placeholder="Ex: Jo√£o Silva"></textarea>
          </div>

          <div class="card">
            <input id="empresa" type="text" placeholder="Nome da empresa" />
            <input id="data" type="text" placeholder="Data" />
            <div class="muted" style="font-weight:950;">Formato gerado:</div>
            <div class="muted">Nome, Empresa, , , Data</div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="card">
          <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div style="font-weight:950;">Resultado</div>
            <button class="btn btn-ghost" id="copyPhrasesBtn" title="Copiar tudo">üìã Copiar</button>
          </div>
          <pre id="resultado" style="margin:10px 0 0; white-space:pre-wrap; word-break:break-word; color:var(--fg); font-weight:850;">‚Äî</pre>
        </div>
      </section>

      <!-- ===== 5W2H ===== -->
      <section id="treinamento" aria-label="Plano de a√ß√£o 5W2H">
        <div class="section-head">
          <div>
            <h2>Plano de A√ß√£o 5W2H</h2>
            <div class="muted">Clique em copiar para usar no laudo/treinamento</div>
          </div>
        </div>

        <div class="grid" id="w2hGrid"></div>
      </section>

      <!-- ===== RISCOS POR EMPRESA ===== -->
      <section id="riscos_empresas" aria-label="Riscos por Empresa">
        <div class="section-head">
          <div>
            <h2>Riscos por Empresa</h2>
            <div class="muted">Buscar por risco, empresa ou setor</div>
          </div>
        </div>

        <div class="card">
          <input id="buscaRiscos" type="text" placeholder="Buscar..." />
        </div>

        <div style="height:12px"></div>
        <div id="listaRiscosEmpresas" class="grid"></div>
      </section>

      <!-- ===== NRs ===== -->
      <section id="nrs" aria-label="Normas Regulamentadoras">
        <div class="section-head">
          <div>
            <h2>Normas Regulamentadoras</h2>
            <div class="muted">Resumo r√°pido + copiar t√≠tulo</div>
          </div>
        </div>

        <div class="grid" id="nrGrid"></div>
      </section>

      <!-- ===== PAINEL T√âCNICO ===== -->
      <section id="painel_tecnico" aria-label="Painel T√©cnico">
        <div class="section-head">
          <div>
            <h2>Painel T√©cnico</h2>
            <div class="muted">Modelos + FAQ (accordion)</div>
          </div>
        </div>

        <div class="grid">
          <div class="card">
            <h3 style="margin-top:0; font-weight:950;">üìÇ Modelos prontos</h3>
            <ul style="margin:0; padding-left:18px; line-height:1.7; font-weight:900; color:var(--fg);">
              <li><a href="https://drive.google.com/drive/folders/1TGYf5eNYzIcKbtL5x2BRb-pmc5VYGQQ-?usp=drive_link" target="_blank" rel="noreferrer" title="Abrir pasta no Drive">üìÑ PPP</a></li>
              <li><a href="https://drive.google.com/drive/folders/1y0iZMFTM9yVcs771L3o6ldhY_YIcinC9?usp=drive_link" target="_blank" rel="noreferrer" title="Abrir pasta no Drive">üìù Ordem de Servi√ßos</a></li>
              <li><a href="https://drive.google.com/drive/folders/17GqBa56ZkdBW7OTaDcfnaaSeZQyw1u0j?usp=drive_link" target="_blank" rel="noreferrer" title="Abrir pasta no Drive">üìú Certificados</a></li>
            </ul>
            <div style="height:10px"></div>
            <div class="muted" style="font-weight:900;">Dica: mantenha esses links sempre atualizados.</div>
          </div>

          <div class="card">
            <h3 style="margin-top:0; font-weight:950;">‚ùì FAQ</h3>
            <div class="accordion" id="faq"></div>
          </div>
        </div>
      </section>

      <footer>
        <div class="row" style="justify-content:space-between">
          <div>
            <strong style="color:var(--fg)">¬© 2026 ‚Äî Sistema T√©cnico SST</strong><br />
            <span>Desenvolvido por <strong style="color:var(--fg)">Vytor Vilar</strong></span>
          </div>
          <div class="muted" style="font-weight:950;">
            Atalhos: <span class="badge" title="Alt+1">Alt+1</span> ‚Ä¶ <span class="badge" title="Alt+7">Alt+7</span>
          </div>
        </div>
      </footer>
    </main>

    <!-- ===== FLOATING PANEL ===== -->
    <div class="fab-panel" id="fabPanel" aria-label="Painel flutuante">
      <button class="fab-main" id="fabMain" title="Abrir painel">‚ò∞</button>
      <div class="fab-actions">
        <button class="fab-action" id="fabTop" title="Voltar ao topo">‚¨ÜÔ∏è Topo</button>
        <button class="fab-action" id="fabPdf" title="Salvar PDF da se√ß√£o atual">üßæ PDF</button>
      </div>
    </div>

    <!-- ===== CHAT ===== -->
    <button class="btn btn-primary chat-fab" id="chatFab" title="Abrir chat de ajuda">üí¨ Ajuda</button>

    <div class="chat-box" id="chatBox" role="dialog" aria-label="Chat de Ajuda" aria-hidden="true">
      <div class="chat-top">
        <span>Chat de Ajuda ‚Ä¢ SST</span>
        <button class="btn btn-ghost" id="chatClose" title="Fechar chat">‚úñ</button>
      </div>
      <div class="chat-msgs" id="chatMsgs" aria-live="polite"></div>
      <div class="chat-input">
        <input id="chatInput" type="text" placeholder="Pergunte sobre EPI, NR-06, CA..." />
        <button class="btn btn-primary" id="chatSend" title="Enviar mensagem">Enviar</button>
      </div>
    </div>

    <!-- ===== TOAST ===== -->
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <!-- ===== SENHA ===== -->
  <div class="backdrop" id="passBackdrop" role="dialog" aria-modal="true" aria-label="Acesso restrito">
    <div class="modal">
      <h3>üîí Acesso restrito</h3>
      <p class="hint">Digite a senha para liberar esta se√ß√£o.</p>

      <div class="pass-row">
        <input id="passInput" type="password" placeholder="Senha..." autocomplete="off" />
        <button class="btn btn-ghost" id="passToggle" title="Mostrar/ocultar senha">üëÅ</button>
      </div>

      <div style="height:10px"></div>
      <div class="row" style="justify-content:flex-end">
        <button class="btn btn-primary" id="passConfirm" title="Confirmar senha">Confirmar</button>
      </div>

      <div class="err" id="passErr">Senha incorreta. Tente novamente.</div>
      <div class="muted" style="margin-top:10px; font-weight:900;">
        Dica: voc√™ pode trocar a senha no JS em <code>SENHA_CORRETA</code>.
      </div>
    </div>
  </div>

  <script>
/* =====================
   CONFIG / UTIL
===================== */
const SENHA_CORRETA = "SG393";

const SOUND = {
  click: "click.mp3",
  ok: "success.mp3"
};

function playSound(type){
  const src = type === "ok" ? SOUND.ok : SOUND.click;
  try{
    const a = new Audio(src);
    a.volume = 0.35;
    a.play().catch(()=>{});
  }catch(_){}
}

function toast(msg, kind="ok"){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.className = "toast show " + (kind || "");
  playSound(kind === "ok" ? "ok" : "click");
  setTimeout(()=> t.classList.remove("show"), 1700);
}

async function copyText(text){
  try{
    await navigator.clipboard.writeText(text);
    toast("Copiado!", "ok");
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    toast("Copiado!", "ok");
  }
}

/* ‚úÖ COPIAR UNIVERSAL */
document.addEventListener("click", (e) => {
  const btn = e.target.closest("[data-copy]");
  if(!btn) return;
  const raw = btn.getAttribute("data-copy") || "";
  try{
    const text = decodeURIComponent(raw);
    copyText(text);
  }catch(_){
    copyText(raw);
  }
});

function setTheme(next){
  document.documentElement.setAttribute("data-theme", next);
  localStorage.setItem("theme", next);
}

function initTheme(){
  const saved = localStorage.getItem("theme");
  if(saved === "dark" || saved === "light"){
    setTheme(saved);
    return;
  }
  const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  setTheme(prefersDark ? "dark" : "light");
}

/* =====================
   PASSWORD (somente em abas espec√≠ficas)
===================== */
const app = document.getElementById("app");
const passBackdrop = document.getElementById("passBackdrop");
const passInput = document.getElementById("passInput");
const passErr = document.getElementById("passErr");
const passToggle = document.getElementById("passToggle");
const passConfirm = document.getElementById("passConfirm");

// üîí Abas que exigem senha
const TABS_COM_SENHA = ["riscos", "treinamento", "riscos_empresas"];
let tabPendente = null;

function showPass(){
  passBackdrop.classList.add("active");
  passInput.value = "";
  passErr.classList.remove("show");
  setTimeout(()=> passInput.focus(), 50);
}
function hidePass(){
  passBackdrop.classList.remove("active");
}
function unlock(){
  sessionStorage.setItem("acessoLiberado", "true");
  hidePass();
  toast("Acesso liberado.", "ok");

  if(tabPendente){
    showSection(tabPendente);
    tabPendente = null;
  }
}
function confirmPass(){
  if(passInput.value === SENHA_CORRETA){
    unlock();
  }else{
    passErr.classList.add("show");
    passInput.value = "";
    passInput.focus();
    toast("Senha incorreta.", "err");
  }
}

passToggle.addEventListener("click", ()=>{
  const isPass = passInput.type === "password";
  passInput.type = isPass ? "text" : "password";
  passToggle.textContent = isPass ? "üôà" : "üëÅ";
  playSound("click");
});

passConfirm.addEventListener("click", confirmPass);
passInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter") confirmPass();
});

function boot(){
  initTheme();
  app.hidden = false;
}

/* =====================
   NAV / SECTIONS
===================== */
function showSection(id){
  document.querySelectorAll("main section").forEach(s=> s.classList.remove("active"));
  const sec = document.getElementById(id);
  if(sec) sec.classList.add("active");

  document.querySelectorAll(".tab").forEach(b=> b.setAttribute("aria-selected", "false"));
  const btn = document.querySelector(`.tab[data-tab="${id}"]`);
  if(btn) btn.setAttribute("aria-selected", "true");

  window.scrollTo({ top: 0, behavior: "smooth" });
}

document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const destino = btn.dataset.tab;

    if (TABS_COM_SENHA.includes(destino) && sessionStorage.getItem("acessoLiberado") !== "true"){
      tabPendente = destino;
      showPass();
      return;
    }

    showSection(destino);
    playSound("click");
  });
});

document.addEventListener("keydown", (e)=>{
  if(!e.altKey) return;
  const map = {
    "1":"epis","2":"riscos","3":"empresas","4":"treinamento",
    "5":"riscos_empresas","6":"nrs","7":"painel_tecnico"
  };

  const destino = map[e.key];
  if(!destino) return;

  if (TABS_COM_SENHA.includes(destino) && sessionStorage.getItem("acessoLiberado") !== "true"){
    tabPendente = destino;
    showPass();
    return;
  }

  showSection(destino);
  toast("Se√ß√£o: " + destino, "ok");
});

/* =====================
   FLOATING PANEL
===================== */
const fabPanel = document.getElementById("fabPanel");
document.getElementById("fabMain").addEventListener("click", ()=>{
  fabPanel.classList.toggle("open");
  playSound("click");
});
document.getElementById("fabTop").addEventListener("click", ()=>{
  window.scrollTo({ top: 0, behavior: "smooth" });
  playSound("click");
});
document.getElementById("fabPdf").addEventListener("click", exportSectionPDF);
document.getElementById("pdfBtn").addEventListener("click", exportSectionPDF);

/* =====================
   DATA (EPIs / Riscos)
===================== */
const epis = [
  { categoria: "ü•æ Cal√ßados", nome: "Botina de El√°stico com Bico de PVC - Fujiwara", ca: "48.413", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Bota de Seguran√ßa ComBico de PVC ModeloLeve e Muito Conforto", ca: "45.258", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Sapato de Amarrar em Couro com Palmilha - Fujiwara (Branco/Preto)", ca: "41.858", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Sapato Antiderrapante Imperme√°vel - Steelflex", ca: "38.590", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Bota de PVC Meio Cano (Branco/Preto) - Bracol", ca: "37.456", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Bota de Seguranca em couro Nobuck com cadar√ßo Dubai Eletrista bico PVC- Bracol", ca: "48.383", imagem: "" },
  { categoria: "ü•æ Cal√ßados", nome: "Bota de Seguran√ßa Bicode Composite NR10Eletricista - Bracol", ca: "38.530", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de Algod√£o Tricotada Mesclada - Volk", ca: "25.773", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de Malha Neotato PU Preta - Volk", ca: "30.916", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de L√°tex Multiuso para Uso Qu√≠mico/Biol√≥gico (Amarela/Azul) - Danny", ca: "39.564", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Pegasus PRO Coleta de Lixo e Servi√ßos Gerais Bicolor - Volk", ca: "28.709", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de L√°tex Neoprene - Volk", ca: "37.900", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Nitr√≠lica Verde para Uso Qu√≠mico/Biol√≥gico 35cm - Delta Plus", ca: "42.938", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva PVC Forrada Cano Longo Palma √Åspera - Danny", ca: "37.559", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Malha de A√ßo - Danny", ca: "6.257", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de Vaqueta Petroleira Crua - Protcap", ca: "15.061", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Coral Resist√™ncia a Cortes e Furos at√© 350¬∫ - Danny", ca: "15.366", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de Seguran√ßa Confort T√©rmica L√°tex com Forro para Limpeza - Danny", ca: "15.532", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva de L√°tex Cano Longo Longatex - Danny", ca: "9.567", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Resistente ao Corte N√≠vel 5 Cut Smart - Volk", ca: "47.068", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Hand N√≠trilo Lona - Handex", ca: "44.524", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva Hand Oil Cut - Handex", ca: "39.416", imagem: "" },
  { categoria: "üß§ Luvas", nome: "Luva De Raspa", ca: "10.074", imagem: "" },
  { categoria: "ü¶æ Mangotes", nome: "Mangote Anti-Corte e T√©rmico 45cm - Delta Plus", ca: "41.361", imagem: "" },
  { categoria: "ü¶æ Mangotes", nome: "Mangote de Raspa Soldador com El√°sticos 40cm - Zanel", ca: "16.073", imagem: "" },
  { categoria: "ü¶∫ Aventais", nome: "Avental de Raspa 120x60cm sem Emendas - Zanel", ca: "13.989", imagem: "" },
  { categoria: "ü¶∫ Aventais", nome: "Avental de PVC Branco - Maicol", ca: "37.729", imagem: "" },
  { categoria: "ü¶∫ Aventais", nome: "Avental De Prote√ß√£o De PVC Cores Balask - Branco", ca: "6.429", imagem: "" },
  { categoria: "ü¶∫ Aventais", nome: "Avental De Prote√ß√£o De PVC Cores Balask - Preto", ca: "6.429", imagem: "" },
  { categoria: "ü¶∫ Aventais", nome: "Avental de Vinil Transparente Tira Soldada", ca: "38.316", imagem: "" },
  { categoria: "üò∑ M√°scaras", nome: "M√°scara PFF1 com ProSafety - Delta Plus", ca: "38.501", imagem: "" },
  { categoria: "üò∑ M√°scaras", nome: "M√°scara N95 PF2 - Nutriex Safety", ca: "46.868", imagem: "" },
  { categoria: "üò∑ M√°scaras", nome: "M√°scara PFF2 - Delta Plus", ca: "38.503", imagem: "" },
  { categoria: "üìå Epis", nome: "Creme Protetor Luva Quimica 3em1 - Nutriex", ca: "43.802", imagem: "" },
  { categoria: "üìå Epis", nome: "Cinturao de Seguran√ßa Steelflex com 1 ponto CQCT1111 + Talabarte Duplo em Y Com Fita Tubular", ca: "45.069", imagem:"" },
  { categoria: "üìå Epis", nome: "Macac√£o de Seguranca Branco - SteelFlex", ca: "39.707", imagem: "" },
  { categoria: "üìå Epis", nome: "Luva Vinil Sem P√≥ Descartavel c/100 - Descarpack", ca: "44.050", imagem: "" },
  { categoria: "üìå Epis", nome: "Mascara De Solda", ca: "14.199", imagem:"" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Japona T√©rmica Frigor√≠fica Azul Marinho - Maicol", ca: "10.975", imagem: "" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Cal√ßa De Nylon T√©rmica Imperme√°vel Para C√¢mara Fria - Maicol", ca: "10.976", imagem: "" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Capuz Balaclava T√©rmico para C√¢mara Fria Suedine - Maicol", ca: "10.979", imagem: "" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Mei√£o T√©rmico - Maicol", ca: "10.977", imagem: "" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Luva T√©rmica Frigor√≠fica em Nylon Baixa Temperatura -35¬∫ - Maicol", ca: "10.978", imagem: "" },
  { categoria: "üß• Vestu√°rio T√©rmico", nome: "Bota T√©rmica", ca: "42.632", imagem: "" },
  { categoria: "üë∑‚Äç Vestu√°rio", nome: "Camisa Com Refletivo Para Eletricista Cinza - Maicol", ca: "44.108", imagem: "" },
  { categoria: "üë∑‚Äç Vestu√°rio", nome: "Cal√ßa Classe 2 Cinza Com Refletivo - Maicol", ca: "44.109", imagem: "" },
  { categoria: "üë∑‚Äç Vestu√°rio", nome: "Blus√£o PVC Forrado Com Capuz", ca: "29.790", imagem: "" },
  { categoria: "üë∑‚Äç Vestu√°rio", nome: "Cal√ßa De Chuva Em PVC Forrada Amarela", ca: "37.536", imagem: "" },
  { categoria: "ü¶∫ Colete", nome: "Colete Tipo X Laranja Steelflex", ca: "38.175", imagem: "" },
  { categoria: "ü¶∫ Colete", nome: "Colete SteelFlex Refletivo Laranja Fluorescente", ca: "42.716", imagem: "" },
  { categoria: "üõ° Prote√ß√£o Facial", nome: "Protetor Facial Jabre Carneira Hipoalerg√™nica com Regulagem por Catraca Tamanho 8 - Delta Plus", ca: "47.620", imagem: "" },
  { categoria: "üõ° Prote√ß√£o Facial", nome: "Protetor Facial com Carneira Hipoalerg√™nica com regulagem e f√°cil ajuste - Delta Plus", ca: "10.975", imagem: "" },
  { categoria: "üõ° Prote√ß√£o Facial", nome: "Protetor Facial Telado Dystray - Ideal Para Ro√ßadeira", ca: "36.802", imagem: "" },
  { categoria: "üëì √ìculos", nome: "√ìculos de Seguran√ßa Ampla Vis√£o - Galeras Clear", ca: "35.268", imagem: "" },
  { categoria: "üëì √ìculos", nome: "√ìculos Prote√ß√£o Sobrepor Antirrisco Hekla Incolor - Delta Plus", ca: "38.253", imagem: "" },
  { categoria: "üëì √ìculos", nome: "√ìculos de Seguran√ßa tipo RJ Vvision 100 incolor - Volk", ca: "42.716", imagem: "" },
  { categoria: "üéß Prote√ß√£o Auditiva", nome: "Abafador de Ru√≠do Combat 10DB - Maicol", ca: "10.977", imagem: "" },
  { categoria: "üéß Prote√ß√£o Auditiva", nome: "Abafador de Ru√≠do SoftSlim 18DB - Camper", ca: "33.135", imagem: "" },
  { categoria: "üéß Prote√ß√£o Auditiva", nome: "Abafador de Ru√≠do ConfortPlus 26DB - Camper", ca: "48.054", imagem: "" },
  { categoria: "üéß Prote√ß√£o Auditiva", nome: "Abafador de Ru√≠do Combat 10DB - Delta Plus", ca: "19.405", imagem: "" },
  { categoria: "üéß Prote√ß√£o Auditiva", nome: "Abafador Concha Interlagos 23DB - Delta Plus", ca: "35.003", imagem: "" }
];

const riscosModelos = [
  { tipo:"fisico", titulo:"üìò F√çSICO - Parte 1", texto:"De acordo com a inspe√ß√£o realizada no ambiente de trabalho e atividades executadas pelo trabalhador, e de acordo com a NR 15 da portaria 3.214/78 do M.T.E, o mesmo est√° exposto a agentes ambientais nocivos √† sa√∫de ao risco F√≠sico." },
  { tipo:"fisico", titulo:"üìò F√çSICO - Parte 2", texto:"As atividades de trabalho realizadas neste LTCAT n√£o s√£o consideradas de Condi√ß√µes Especiais de Trabalho e, portanto, n√£o s√£o prejudiciais √† sa√∫de ou integridade f√≠sica dos trabalhadores segundo os requisitos do Decreto Federal 3048/1999 e seu Anexo IV." },
  { tipo:"biologico", titulo:"üß¨ BIOL√ìGICO - Parte 1", texto:"De acordo com a inspe√ß√£o realizada no ambiente de trabalho e atividades executadas pelo trabalhador, e de acordo com a NR 15 da portaria 3.214/78 do M.T.E, o mesmo est√° exposto a agentes ambientais nocivos √† sa√∫de ao risco Biol√≥gico." },
  { tipo:"biologico", titulo:"üß¨ BIOL√ìGICO - Parte 2", texto:"As atividades de trabalho realizadas neste LTCAT n√£o s√£o consideradas de Condi√ß√µes Especiais de Trabalho e, portanto, n√£o s√£o prejudiciais √† sa√∫de ou integridade f√≠sica dos trabalhadores segundo os requisitos do Decreto Federal 3048 / 1999 e seu Anexo IV." },
  { tipo:"biologico", titulo:"üß¨ BIOL√ìGICO - Parte 3", texto:"As atividades de trabalho realizadas neste LTCAT s√£o consideradas de Condi√ß√µes Especiais de Trabalho e, portanto, s√£o prejudiciais √† sa√∫de ou integridade f√≠sica dos trabalhadores segundo os requisitos do Decreto Federal 3048 / 1999 e seu Anexo IV." },
  { tipo:"quimico", titulo:"üß™ QU√çMICO - Parte 1", texto:"De acordo com a inspe√ß√£o realizada no ambiente de trabalho e atividades executadas pelo trabalhador, e de acordo com a NR 15 da portaria 3.214/78 do M.T.E, o mesmo est√° exposto a agentes ambientais nocivos √† sa√∫de ao risco Qu√≠mico." },
  { tipo:"quimico", titulo:"üß™ QU√çMICO - Parte 2", texto:"As atividades de trabalho realizadas neste LTCAT n√£o s√£o consideradas de Condi√ß√µes Especiais de Trabalho e, portanto, n√£o s√£o prejudiciais √† sa√∫de ou integridade f√≠sica dos trabalhadores segundo os requisitos do Decreto Federal 3048 / 1999 e seu Anexo IV." },
  { tipo:"quimico", titulo:"üß™ QU√çMICO - Parte 3", texto:"As atividades de trabalho realizadas neste LTCAT s√£o consideradas de Condi√ß√µes Especiais de Trabalho e, portanto, s√£o prejudiciais √† sa√∫de ou integridade f√≠sica dos trabalhadores segundo os requisitos do Decreto Federal 3048 / 1999 e seu Anexo IV." },
];

const riscosEmpresas = [
  { emoji:"üîä", risco:"RU√çDO", empresa:"FAP IND√öSTRIA E COM√âRCIO DE ACR√çLICOS LTDA", setor:"Dobra" },
  { emoji:"üå´", risco:"POEIRA", empresa:"FAP IND√öSTRIA E COM√âRCIO DE ACR√çLICOS LTDA", setor:"Polimento" },
  { emoji:"üõ†", risco:"FERRAMENTAS MANUAIS/M√ÅQUINAS E EQUIPAMENTOS", empresa:"FAP IND√öSTRIA E COM√âRCIO DE ACR√çLICOS LTDA", setor:"Produ√ß√£o" },
  { emoji:"üßº", risco:"PRODUTOS DOMISSANIT√ÅRIOS DE LIMPEZA", empresa:"FAP IND√öSTRIA E COM√âRCIO DE ACR√çLICOS LTDA", setor:"Limpeza" },
  { emoji:"üë∑‚Äç‚ôÇÔ∏è", risco:"TRABALHO EM ALTURA", empresa:"JF CONSTRUCAO E PAVIMENTA√á√ÉO LTDA", setor:"Obra" },
  { emoji:"üß∫", risco:"TINTAS/DILUENTES", empresa:"PREST-MAC COMERCIAL E INDUSTRIAL LTDA", setor:"Pintura" },
  { emoji:"‚ö°", risco:"TRABALHO COM ELETRICIDADE", empresa:"WGL SOLU√á√ïES EM TECNOLOGIAS E SERVI√áOS LTDA", setor:"Manuten√ß√£o/El√©trica (Preventiva/Corretiva)" },
  { emoji:"üß¥", risco:"LUBRIFICANTES", empresa:"PREST-MAC COMERCIAL E INDUSTRIAL LTDA", setor:"Produ√ß√£o" },
  { emoji:"‚ú®", risco:"PRODUTOS QU√çMICOS DE EST√âTICA", empresa:"ELENICE GERALDO DOS SANTOS CABELEIREIROS LTDA", setor:"Sal√£o" },
  { emoji:"üçî", risco:"MANIPULA√á√ÉO DE ALIMENTOS", empresa:"P√ÉES E DOCES CHAL√â DOCILE LTDA", setor:"Cozinha" },
  { emoji:"üöó", risco:"CONDU√á√ÉO DE VE√çCULOS AUTOMOTORES", empresa:"POLICOMP COMERCIO DE COMPONENTES", setor:"Estoque/Transporte" },
  { emoji:"üî©", risco:"FUMOS MET√ÅLICOS DE ESTANHO", empresa:"POLICOMP COMERCIO DE COMPONENTES", setor:"T√©cnico" },
  { emoji:"üí•", risco:"RADIA√á√ÉO N√ÉO IONIZANTE", empresa:"SPADA MIDIA E EVENTOS LTDA", setor:"Obra/Serralheria" },
  { emoji:"üò∏üê∂", risco:"PRODUTOS QU√çMICOS DE BELEZA PARA C√ÉES E GATOS", empresa:"CAROL PET SHOP COMERCIO DE RACOES ACESSORIOS BANHO E TOSA LTDA", setor:"Banho e Tosa" },
  { emoji:"üì¶", risco:"TRABALHOS DE SEPARA√á√ÉO DE EMBALAGENS", empresa:"MONTE VIRGINNE COM√âRCIO DE SUCATAS DE PL√ÅSTICOS LTDA ME", setor:"Produ√ß√£o/Separa√ß√£o" },
  { emoji:"‚ùÑ", risco:"FRIO", empresa:"LANCHONETE E ESFIHARIA NOVA ALIANCA LTDA", setor:"Cozinha" },
  { emoji:"üß¥", risco:"√ìLEO SINT√âTICO", empresa:"DELTA ROTULADORAS EIRELI", setor:"F√°brica" },
  { emoji:"üóú", risco:"ESTANHO", empresa:"RAUL SANTOS FERREIRA", setor:"Produ√ß√£o" },
  { emoji:"ü©π", risco:"ACIDENTES", empresa:"RIO BONITO COMERCIO E SERVICOS PARA PISCINAS LTDA", setor:"Assistencia" },
  { emoji:"‚öïÔ∏è", risco:"VIRUS E BACT√âRIAS", empresa:"RIO BONITO COMERCIO E SERVICOS PARA PISCINAS LTDA", setor:"Externo" },
  { emoji:"üí¶", risco:"CLORO", empresa:"RIO BONITO COMERCIO E SERVICOS PARA PISCINAS LTDA", setor:"Externo" },
];

const w2h = [
  { k:"What (O Qu√™)", v:"Treinamento de NR-06" },
  { k:"Who (Quem)", v:"Coordenador da empresa" },
  { k:"When (Quando)", v:"Permanente" },
  { k:"Where (Onde)", v:"Ambiente laboral" },
  { k:"Why (Porqu√™)", v:"Conscientizar os colaboradores sobre o uso de EPI." },
  { k:"How (Como)", v:"Palestra NR-06, treinamento de EPI." },
  { k:"How much (Custo)", v:"***" }
];

const nrs = [
  { t:"NR-06 ‚Äî Equipamentos de Prote√ß√£o Individual (EPI)", d:"Regulamenta fornecimento, uso e conserva√ß√£o dos EPIs, incluindo CA." },
  { t:"NR-07 ‚Äî PCMSO / Sa√∫de Ocupacional", d:"Diretrizes para controle m√©dico de sa√∫de ocupacional e exames." },
  { t:"NR-10 ‚Äî Eletricidade", d:"Requisitos m√≠nimos para seguran√ßa em instala√ß√µes e servi√ßos el√©tricos." },
  { t:"NR-12 ‚Äî M√°quinas e Equipamentos", d:"Medidas de preven√ß√£o de acidentes com m√°quinas e prote√ß√µes." },
  { t:"NR-18 ‚Äî Constru√ß√£o", d:"Condi√ß√µes de seguran√ßa e bem-estar no canteiro de obras." },
  { t:"NR-23 ‚Äî Inc√™ndio / Brigada", d:"Preven√ß√£o e combate a princ√≠pios de inc√™ndio e evacua√ß√£o." },
  { t:"NR-33 ‚Äî Espa√ßo Confinado", d:"Reconhecer, avaliar e controlar riscos em espa√ßo confinado." },
  { t:"NR-35 ‚Äî Trabalho em Altura", d:"Requisitos para trabalhos acima de 2 metros, com planejamento e AR." }
];

const faq = [
  { q:"Quando √© necess√°rio renovar os EPIs?", a:"Sempre que o CA vencer, houver desgaste ou prazo do fabricante expirar." },
  { q:"Qual a validade do ASO?", a:"Admissional: antes da fun√ß√£o; Peri√≥dico: anual/bienal; Retorno: ap√≥s afastamento ‚â• 30 dias; Mudan√ßa de fun√ß√£o: se alterar riscos; Demissional: at√© a rescis√£o." },
  { q:"Quem deve elaborar o PCMSO?", a:"Somente M√©dico do Trabalho registrado no CRM." },
  { q:"O que √© o PGR e quem deve elabor√°-lo?", a:"Programa de Gerenciamento de Riscos elaborado por Engenheiro ou T√©cnico de Seguran√ßa do Trabalho." },
  { q:"Qual a periodicidade do treinamento NR-06 (EPI)?", a:"Na admiss√£o, mudan√ßa de fun√ß√£o, introdu√ß√£o de novos riscos e periodicamente (m√≠nimo 1 vez ao ano)." },
  { q:"O que deve constar na ficha de EPI?", a:"Nome, CA, data de entrega, prazo de troca, assinaturas e instru√ß√µes de uso." }
];

/* =====================
   RENDER: EPIs
===================== */
const catalog = document.getElementById("catalog");
const searchInput = document.getElementById("searchInput");
const epiCount = document.getElementById("epiCount");

function iconForCategory(cat = ""){
  const c = cat.toLowerCase();
  const icons = {
    calcados: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M4 13c3 0 4-3 6-3s3 2 4 3c1 1 3 2 6 2v4H4v-6z"/>
      <path d="M7 10c1.2 1.2 2.3 2 3.8 2 2.2 0 3.2-2 3.2-4V5"/>
    </svg>`,
    luvas: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M8 21V11a2 2 0 0 1 2-2h0"/>
      <path d="M10 21V9a2 2 0 0 1 2-2h0"/>
      <path d="M12 21V8a2 2 0 0 1 2-2h0"/>
      <path d="M14 21V9a2 2 0 0 1 2-2h0"/>
      <path d="M8 21h10a3 3 0 0 0 3-3v-4a3 3 0 0 0-3-3h-1"/>
    </svg>`,
    mascaras: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M4 10c2-2 4-3 8-3s6 1 8 3v5c0 3-3 6-8 6s-8-3-8-6v-5z"/>
      <path d="M7 12h10"/>
      <path d="M8 9l-2-2"/>
      <path d="M16 9l2-2"/>
    </svg>`,
    aventais: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M9 3h6l1 5H8l1-5z"/>
      <path d="M8 8v13h8V8"/>
      <path d="M8 11H6a2 2 0 0 1-2-2V8"/>
      <path d="M16 11h2a2 2 0 0 0 2-2V8"/>
    </svg>`,
    mangotes: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M7 4h10l-1 16H8L7 4z"/>
      <path d="M9 8h6"/>
      <path d="M9 12h6"/>
    </svg>`,
    auditiva: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M4 12a8 8 0 0 1 16 0"/>
      <path d="M6 12a6 6 0 0 1 12 0"/>
      <path d="M8 12a4 4 0 0 1 8 0"/>
      <path d="M7 14v6"/>
      <path d="M17 14v6"/>
    </svg>`,
    oculos: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M3 12l2-4h4l2 4"/>
      <path d="M13 12l2-4h4l2 4"/>
      <path d="M11 12h2"/>
      <path d="M5 12c0 2 1 3 3 3s3-1 3-3"/>
      <path d="M14 12c0 2 1 3 3 3s3-1 3-3"/>
    </svg>`,
    facial: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M6 7h12v6c0 5-4 9-6 9s-6-4-6-9V7z"/>
      <path d="M9 7V4h6v3"/>
    </svg>`,
    vestuario: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M9 4l3 2 3-2 4 3-2 4v13H7V11L5 7l4-3z"/>
    </svg>`,
    outros: `<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" aria-hidden="true">
      <path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5.5 20l2-7L2 9h7l3-7z"/>
    </svg>`
  };

  if(c.includes("cal√ß") || c.includes("calc")) return icons.calcados;
  if(c.includes("luva")) return icons.luvas;
  if(c.includes("m√°sc") || c.includes("masc")) return icons.mascaras;
  if(c.includes("avental")) return icons.aventais;
  if(c.includes("mangote")) return icons.mangotes;
  if(c.includes("auditiva") || c.includes("abafador")) return icons.auditiva;
  if(c.includes("√≥culos") || c.includes("oculos")) return icons.oculos;
  if(c.includes("facial")) return icons.facial;
  if(c.includes("vestu")) return icons.vestuario;
  return icons.outros;
}

function renderEpis(list){
  catalog.innerHTML = list.map((e, i)=>`
    <div class="card epi" role="article" aria-label="EPI ${i+1}">
      <div class="epi-top">
        <div class="epi-icon" title="Categoria">${iconForCategory(e.categoria)}</div>
        <div class="epi-cat" title="Categoria do EPI">${e.categoria}</div>
      </div>

      <h3 title="${String(e.nome).replace(/"/g, '&quot;')}">${e.nome}</h3>

      <div class="epi-sub">
        <span class="badge" title="Certificado de Aprova√ß√£o">CA N¬∫: ${e.ca}</span>

        <div class="row" style="gap:8px; justify-content:flex-end;">
          <button class="btn btn-ghost" title="Copiar CA" onclick="copyText('${String(e.ca).replace(/'/g,"\\'")}')">üìã CA</button>
          <button class="btn btn-ghost" title="Copiar nome do EPI" onclick="copyText(${JSON.stringify(e.nome)})">üìù Nome</button>
        </div>
      </div>
    </div>
  `).join("");

  epiCount.textContent = `${list.length} item(ns) exibido(s)`;
}

/* =====================
   EPIs ‚Ä¢ DROPDOWN CYBER
===================== */
let __selectedCategory = "";

function populateNeoCategories(){
  const neo = document.getElementById("categoryNeo");
  if(!neo) return;

  const panel = neo.querySelector(".neo-panel");
  const label = neo.querySelector(".neo-label");
  const trigger = neo.querySelector(".neo-trigger");
  if(!panel || !label || !trigger) return;

  const cats = [...new Set(epis.map(x => x.categoria).filter(Boolean))]
    .sort((a,b)=>a.localeCompare(b));

  panel.innerHTML = "";

  const all = document.createElement("button");
  all.type = "button";
  all.className = "neo-option";
  all.dataset.value = "";
  all.textContent = "üåê Todas as categorias";
  panel.appendChild(all);

  cats.forEach(c=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "neo-option";
    b.dataset.value = c;
    b.textContent = c;
    panel.appendChild(b);
  });

  function setOpen(open){
    neo.dataset.open = String(open);
    trigger.setAttribute("aria-expanded", String(open));
  }

  trigger.addEventListener("click", ()=>{
    setOpen(!(neo.dataset.open === "true"));
  });

  panel.addEventListener("click", (e)=>{
    const opt = e.target.closest(".neo-option");
    if(!opt) return;

    __selectedCategory = opt.dataset.value || "";
    label.textContent = opt.textContent;
    setOpen(false);
    filterEpisNeo();
  });

  document.addEventListener("click", (e)=>{
    if(!neo.contains(e.target)) setOpen(false);
  });

  // default
  __selectedCategory = "";
  label.textContent = "üåê Todas as categorias";
}

function filterEpisNeo(){
  const q = (searchInput?.value || "").toLowerCase().trim();
  const cat = __selectedCategory;

  const filtered = epis.filter(e=>{
    const okQ =
      String(e.nome).toLowerCase().includes(q) ||
      String(e.ca).toLowerCase().includes(q) ||
      String(e.categoria).toLowerCase().includes(q);

    const okC = !cat || e.categoria === cat;
    return okQ && okC;
  });

  renderEpis(filtered);
}

document.getElementById("clearEpiBtn").addEventListener("click", ()=>{
  searchInput.value = "";
  __selectedCategory = "";
  const lbl = document.querySelector("#categoryNeo .neo-label");
  if(lbl) lbl.textContent = "üåê Todas as categorias";
  filterEpisNeo();
  toast("Filtros limpos!", "ok");
});

searchInput.addEventListener("input", filterEpisNeo);

/* =====================
   RENDER: Riscos
===================== */
const riskCards = document.getElementById("riskCards");
function renderRiskCards(list){
  riskCards.innerHTML = list.map(r=>`
    <div class="card" data-risk="${r.tipo}">
      <div style="font-weight:950; margin-bottom:8px;">${r.titulo}</div>
      <div class="muted" style="font-weight:850; line-height:1.4;">${r.texto}</div>
      <div style="height:10px"></div>
      <button class="btn btn-primary" title="Copiar texto" data-copy="${encodeURIComponent(r.texto)}">Copiar</button>
    </div>
  `).join("");
}

document.getElementById("riskFilter").addEventListener("change", (e)=>{
  const v = e.target.value;
  const list = v === "todos" ? riscosModelos : riscosModelos.filter(x=>x.tipo===v);
  renderRiskCards(list);
  playSound("click");
});

/* =====================
   RENDER: 5W2H
===================== */
const w2hGrid = document.getElementById("w2hGrid");
function renderW2H(){
  w2hGrid.innerHTML = w2h.map(x=>`
    <div class="card">
      <div style="font-weight:950;">${x.k}</div>
      <div class="muted" style="margin-top:6px; font-weight:850;">${x.v}</div>
      <div style="height:10px"></div>
      <button class="btn btn-primary" title="Copiar" data-copy="${encodeURIComponent(x.v)}">Copiar</button>
    </div>
  `).join("");
}

/* =====================
   RENDER: Riscos por Empresa
===================== */
const listaRiscosEmpresas = document.getElementById("listaRiscosEmpresas");
function renderRiscosEmpresas(list){
  listaRiscosEmpresas.innerHTML = list.map(i=>`
    <div class="card">
      <div style="font-weight:950;">${i.emoji} ${i.risco}</div>
      <div class="muted" style="margin-top:6px; font-weight:850;">${i.empresa} ‚Ä¢ Setor: ${i.setor}</div>
      <div style="height:10px"></div>
      <button class="btn btn-ghost" title="Copiar empresa" data-copy="${encodeURIComponent(i.empresa)}">üìã Copiar empresa</button>
    </div>
  `).join("");
}
document.getElementById("buscaRiscos").addEventListener("input", (e)=>{
  const t = e.target.value.toLowerCase();
  const f = riscosEmpresas.filter(i => (i.risco+" "+i.empresa+" "+i.setor).toLowerCase().includes(t));
  renderRiscosEmpresas(f);
});

/* =====================
   RENDER: NRs
===================== */
const nrGrid = document.getElementById("nrGrid");
function renderNRs(){
  nrGrid.innerHTML = nrs.map(n=>`
    <div class="card">
      <div style="font-weight:950;">
        <span class="nr-title">${n.t}</span>
      </div>
      <div class="muted" style="margin-top:6px; font-weight:850; line-height:1.4;">${n.d}</div>
      <div style="height:10px"></div>
      <button class="btn btn-primary" title="Copiar t√≠tulo" data-copy="${encodeURIComponent(n.t)}">Copiar</button>
    </div>
  `).join("");
}

/* =====================
   FAQ
===================== */
const faqEl = document.getElementById("faq");
function renderFAQ(){
  faqEl.innerHTML = faq.map((x, idx)=>`
    <div class="acc-item">
      <button class="acc-btn" title="Abrir/fechar" aria-expanded="false" data-acc="${idx}">
        ${x.q}
        <span>‚ñæ</span>
      </button>
      <div class="acc-body">${x.a}</div>
    </div>
  `).join("");
}
document.addEventListener("click", (e)=>{
  const b = e.target.closest(".acc-btn");
  if(!b) return;
  const item = b.closest(".acc-item");
  item.classList.toggle("active");
  const expanded = item.classList.contains("active");
  b.setAttribute("aria-expanded", expanded ? "true" : "false");
  playSound("click");
});

/* =====================
   Frases Empresa
===================== */
const resultado = document.getElementById("resultado");
function gerarFrases(){
  const nomes = document.getElementById("nomes").value
    .split("\n").map(s=>s.trim()).filter(Boolean);
  const empresa = document.getElementById("empresa").value.trim();
  const data = document.getElementById("data").value.trim();

  const out = nomes.map(nome => `${nome}, ${empresa}, , , ${data}`).join("\n");
  resultado.textContent = out || "‚Äî";
  toast("Frases geradas.", "ok");
}

document.getElementById("genPhrasesBtn").addEventListener("click", gerarFrases);
document.getElementById("copyPhrasesBtn").addEventListener("click", ()=>{
  copyText(resultado.textContent || "");
});

document.getElementById("exportTxtBtn").addEventListener("click", ()=>{
  const content = resultado.textContent || "";
  const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "frases_empresa.txt";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  toast("TXT exportado.", "ok");
});

/* =====================
   PDF (se√ß√£o atual)
===================== */
function getActiveSection(){
  return document.querySelector("main section.active");
}

async function exportSectionPDF(){
  const sec = getActiveSection();
  if(!sec){
    toast("Nenhuma se√ß√£o ativa.", "err");
    return;
  }

  const title = sec.querySelector("h2") ? sec.querySelector("h2").textContent.trim() : "SST";
  const text = sec.innerText.trim();

  const { jsPDF } = window.jspdf || {};
  if(!jsPDF){
    toast("jsPDF n√£o carregou.", "err");
    return;
  }

  const doc = new jsPDF({ unit:"pt", format:"a4" });
  const margin = 36;
  const maxW = 595 - margin*2;

  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text(title, margin, 48);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(10);

  const lines = doc.splitTextToSize(text, maxW);
  let y = 70;

  for(const line of lines){
    if(y > 800){
      doc.addPage();
      y = 48;
    }
    doc.text(line, margin, y);
    y += 14;
  }

  doc.save((title || "sst").replace(/\s+/g,"_").toLowerCase() + ".pdf");
  toast("PDF salvo.", "ok");
}

/* =====================
   CHAT (local simples)
===================== */
const chatFab = document.getElementById("chatFab");
const chatBox = document.getElementById("chatBox");
const chatClose = document.getElementById("chatClose");
const chatMsgs = document.getElementById("chatMsgs");
const chatInput = document.getElementById("chatInput");
const chatSend = document.getElementById("chatSend");

function chatAdd(text, who="bot"){
  const wrap = document.createElement("div");
  wrap.className = who === "me" ? "me" : "bot";
  wrap.innerHTML = `<div class="bubble">${text}</div>`;
  chatMsgs.appendChild(wrap);
  chatMsgs.scrollTop = chatMsgs.scrollHeight;
}

function answerLocal(q){
  const m = q.toLowerCase();
  if(m.includes("nr-06") || m.includes("epi")){
    return "NR-06 trata do EPI: fornecimento, treinamento, uso correto e CA. Quer que eu gere um texto padr√£o para laudo/OS?";
  }
  if(m.includes("aso")){
    return "ASO: admissional antes da fun√ß√£o; peri√≥dico conforme risco; retorno ap√≥s afastamento ‚â• 30 dias; mudan√ßa de fun√ß√£o quando altera risco; demissional at√© rescis√£o.";
  }
  if(m.includes("pgr")){
    return "PGR √© o Programa de Gerenciamento de Riscos. Em geral √© elaborado por Engenheiro ou T√©cnico de Seguran√ßa do Trabalho.";
  }
  if(m.includes("ca")){
    return "CA (Certificado de Aprova√ß√£o) √© o registro do EPI aprovado. Se vencer, substitui e registra nova entrega.";
  }
  return "Me diga o tema (EPI, CA, ASO, NR, PGR, PCMSO) que eu te respondo com um texto pronto.";
}

function sendChat(){
  const q = chatInput.value.trim();
  if(!q) return;
  chatAdd(q, "me");
  chatInput.value = "";
  setTimeout(()=> chatAdd(answerLocal(q), "bot"), 220);
}

chatFab.addEventListener("click", ()=>{
  chatBox.classList.toggle("active");
  chatBox.setAttribute("aria-hidden", chatBox.classList.contains("active") ? "false" : "true");
  playSound("click");
  if(chatBox.classList.contains("active")) setTimeout(()=> chatInput.focus(), 50);
});
chatClose.addEventListener("click", ()=>{
  chatBox.classList.remove("active");
  chatBox.setAttribute("aria-hidden", "true");
  playSound("click");
});
chatSend.addEventListener("click", sendChat);
chatInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){
    e.preventDefault();
    sendChat();
  }
});

/* =====================
   DROPDOWN: Neo -> Select (Riscos)
===================== */
function bindNeoToNativeSelect(neoId, selectId){
  const neo = document.getElementById(neoId);
  const sel = document.getElementById(selectId);
  if(!neo || !sel) return;

  const trigger = neo.querySelector(".neo-trigger");
  const label = neo.querySelector(".neo-label");
  const panel = neo.querySelector(".neo-panel");

  function setOpen(open){
    neo.dataset.open = String(open);
    trigger?.setAttribute("aria-expanded", String(open));
  }

  trigger?.addEventListener("click", ()=>{
    setOpen(!(neo.dataset.open === "true"));
  });

  panel?.addEventListener("click", (e)=>{
    const opt = e.target.closest(".neo-option");
    if(!opt) return;

    const v = opt.dataset.value || "todos";
    sel.value = v;
    if(label) label.textContent = opt.textContent;

    sel.dispatchEvent(new Event("change", { bubbles:true }));
    setOpen(false);
  });

  document.addEventListener("click", (e)=>{
    if(!neo.contains(e.target)) setOpen(false);
  });
}

/* =====================
   INIT
===================== */
window.addEventListener("DOMContentLoaded", ()=>{
  boot();

  populateNeoCategories();
  renderEpis(epis);
  filterEpisNeo();              // ‚úÖ garante estado inicial correto

  renderRiskCards(riscosModelos);
  bindNeoToNativeSelect("riskNeo", "riskFilter"); // ‚úÖ filtro riscos funcionando

  renderW2H();
  renderRiscosEmpresas(riscosEmpresas);
  renderNRs();
  renderFAQ();

  document.getElementById("statusPill").textContent = "‚úÖ Online";
});
  </script>
</body>
</html>
